<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Squirrel Runner — Autumn Dash</title>
  <style>
    :root{--bg:#f5e6d8;--sky:#ffdca8;--ground:#6b462c;--leaf1:#d96b2b;--leaf2:#f0a64a;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--sky) 0%, #f3dcc6 60%);font-family:Inter, system-ui, sans-serif}
    #gameWrap{display:flex;align-items:center;justify-content:center;height:100vh}
    canvas{background:transparent;box-shadow:0 8px 30px rgba(0,0,0,0.15);border-radius:8px}
    .ui{position:fixed;left:16px;top:16px;color:#5b3b2b;text-shadow:0 1px 0 rgba(255,255,255,0.6)}
    button{padding:8px 12px;border-radius:6px;border:none;background:#8b5a33;color:white;cursor:pointer}
    .hint{font-size:13px;margin-top:6px;color:#6a4a3a}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game" width="900" height="300"></canvas>
  </div>
  <div class="ui">
    <div><strong>Squirrel Runner: Autumn Dash</strong></div>
    <div class="hint">Espacio = saltar • Flecha abajo = agacharse • R = reiniciar</div>
  </div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

const GRAVITY = 0.9;
const GROUND_Y = H - 60;
let speed = 6;
let score = 0;
let gameOver = false;

const SPR_W = 64, SPR_H = 64, SPR_FRAMES = 4;
const spriteCanvas = document.createElement('canvas');
spriteCanvas.width = SPR_W * SPR_FRAMES;
spriteCanvas.height = SPR_H;
const sctx = spriteCanvas.getContext('2d');

function drawSquirrelFrame(ctx2, frameIndex){
  const ox = frameIndex * SPR_W;
  const cx = ox + 32, cy = 36;
  ctx2.clearRect(ox,0,SPR_W,SPR_H);
  ctx2.fillStyle = '#b3784a';
  ctx2.beginPath();
  ctx2.ellipse(cx-6, cy, 22, 18, 0, 0, Math.PI*2);
  ctx2.fill();
  ctx2.fillStyle = '#f4d9bf';
  ctx2.beginPath();
  ctx2.ellipse(cx-4, cy+6, 12, 10, 0, 0, Math.PI*2);
  ctx2.fill();
  ctx2.fillStyle = '#b3784a';
  ctx2.beginPath();
  ctx2.ellipse(cx+18, cy-12, 12, 12, 0, 0, Math.PI*2);
  ctx2.fill();
  ctx2.fillStyle = '#8d4f2b';
  ctx2.beginPath();
  ctx2.moveTo(cx+22, cy-22);
  ctx2.lineTo(cx+28, cy-34);
  ctx2.lineTo(cx+16, cy-24);
  ctx2.closePath();
  ctx2.fill();
  ctx2.fillStyle = '#231f20';
  ctx2.beginPath();
  ctx2.arc(cx+22, cy-14, 2.5, 0, Math.PI*2);
  ctx2.fill();
  ctx2.fillStyle = '#231f20';
  ctx2.beginPath();
  ctx2.arc(cx+27, cy-9, 2, 0, Math.PI*2);
  ctx2.fill();
  const tailOffset = Math.sin(frameIndex*0.9)*6;
  ctx2.fillStyle = '#9a5b2f';
  ctx2.beginPath();
  ctx2.ellipse(cx-24+tailOffset, cy-4, 18, 28, -0.6, 0, Math.PI*2);
  ctx2.fill();
  ctx2.fillStyle = '#6b3f27';
  ctx2.beginPath();
  if(frameIndex%2===0){
    ctx2.ellipse(cx+2, cy+20, 6, 4, 0, 0, Math.PI*2);
    ctx2.ellipse(cx+14, cy+18, 5, 4, 0, 0, Math.PI*2);
  } else {
    ctx2.ellipse(cx+6, cy+18, 6, 4, 0, 0, Math.PI*2);
    ctx2.ellipse(cx+10, cy+20, 5, 4, 0, 0, Math.PI*2);
  }
  ctx2.fill();
}

for(let f=0; f<SPR_FRAMES; f++) drawSquirrelFrame(sctx, f);
const spriteImg = new Image();
spriteImg.src = spriteCanvas.toDataURL();

const player = {x:80,y:GROUND_Y-SPR_H+10,vy:0,w:44,h:46,frame:0,frameTick:0,jumping:false,ducking:false};
let obstacles=[]; let leaves=[];

function spawnObstacle(){
  if(obstacles.length>0){
    const last=obstacles[obstacles.length-1];
    if(W-last.x<250) return; // evita solapamientos
  }
  const type = Math.random()<0.5?'log':'mound';
  const w = type==='log'?50:40;
  const h = type==='log'?24:30;
  obstacles.push({x:W+20,y:GROUND_Y-h+8,w,h,type});
}

function spawnLeaf(){
  leaves.push({x:Math.random()*W,y:-10-Math.random()*50,s:6+Math.random()*8,vx:-1+Math.random()*2,vy:1+Math.random()*2,rot:Math.random()*Math.PI*2,rotSpeed:-0.02+Math.random()*0.04,color:Math.random()<0.5?'#d96b2b':'#f0a64a'});
}
for(let i=0;i<15;i++)spawnLeaf();

const keys={};
window.addEventListener('keydown',e=>{keys[e.code]=true;if(e.code==='Space'||e.code==='ArrowUp')e.preventDefault();if(e.code==='KeyR')reset();});
window.addEventListener('keyup',e=>keys[e.code]=false);

function updatePlayer(){
  if((keys['ArrowDown']||keys['KeyS'])&&!player.jumping)player.ducking=true;else player.ducking=false;
  if((keys['Space']||keys['ArrowUp']||keys['KeyW'])&&!player.jumping){player.vy=-14;player.jumping=true;player.ducking=false;}
  player.vy+=GRAVITY;player.y+=player.vy;
  if(player.y>=GROUND_Y-(player.ducking?34:SPR_H)+10){player.y=GROUND_Y-(player.ducking?34:SPR_H)+10;player.vy=0;player.jumping=false;}
  player.frameTick++;
  if(player.jumping)player.frame=2;else if(player.ducking)player.frame=3;else if(player.frameTick%6===0)player.frame=(player.frame+1)%2;
}

function intersects(a,b){return!(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h)}

function updateObstacles(){
  if(Math.random()<0.015)spawnObstacle();
  for(let i=obstacles.length-1;i>=0;i--){
    obstacles[i].x-=speed;
    if(obstacles[i].x+obstacles[i].w<-50)obstacles.splice(i,1);
  }
}

function drawGround(){ctx.fillStyle='rgba(107,70,44,0.95)';ctx.fillRect(0,GROUND_Y,W,H-GROUND_Y);}

function drawBackground(t){
  ctx.fillStyle='rgba(255,255,255,0.6)';
  ctx.beginPath();ctx.ellipse((t*0.03)%W,60,80,24,0,0,Math.PI*2);ctx.fill();
}

function drawLeaves(){
  for(let i=leaves.length-1;i>=0;i--){
    const L=leaves[i];L.x+=L.vx;L.y+=L.vy;L.rot+=L.rotSpeed;
    if(L.y>H+20||L.x<-30){leaves.splice(i,1);spawnLeaf();continue;}
    ctx.save();ctx.translate(L.x,L.y);ctx.rotate(L.rot);
    ctx.beginPath();ctx.moveTo(0,0);ctx.quadraticCurveTo(L.s/2,L.s/2,0,L.s);ctx.quadraticCurveTo(-L.s/2,L.s/2,0,0);
    ctx.fillStyle=L.color;ctx.fill();ctx.restore();
  }
}

function drawObstacles(){
  for(const ob of obstacles){
    if(ob.type==='log'){
      ctx.fillStyle='#6b3f27';ctx.fillRect(ob.x,ob.y,ob.w,ob.h);
      ctx.fillStyle='#51321e';ctx.fillRect(ob.x+3,ob.y+3,ob.w-6,6);
    } else {
      ctx.fillStyle='#a85a2b';ctx.beginPath();ctx.ellipse(ob.x+ob.w/2,ob.y+ob.h/2,ob.w/2,ob.h/2,0,0,Math.PI*2);ctx.fill();
    }
  }
}

function drawPlayer(){const srcX=player.frame*SPR_W;ctx.drawImage(spriteImg,srcX,0,SPR_W,SPR_H,player.x-4,player.y,SPR_W*0.7,SPR_H*0.7);}

function checkCollisions(){const pbox={x:player.x,y:player.y+(player.ducking?12:0),w:player.w,h:player.h-(player.ducking?14:0)};for(const ob of obstacles){const obox={x:ob.x,y:ob.y,w:ob.w,h:ob.h};if(intersects(pbox,obox))return true;}return false;}

let lastTime=0;
function loop(t){
  if(!lastTime)lastTime=t;const dt=t-lastTime;lastTime=t;
  if(!gameOver){score+=0.01*speed;speed=6+Math.min(4,Math.floor(score/200));updatePlayer();updateObstacles();if(Math.random()<0.05)spawnLeaf();ctx.clearRect(0,0,W,H);drawBackground(t);drawLeaves();drawGround();drawObstacles();drawPlayer();ctx.fillStyle='#5b3b2b';ctx.font='18px system-ui';ctx.fillText('Puntos: '+Math.floor(score),W-150,30);if(checkCollisions()){gameOver=true;}}
  else{ctx.fillStyle='rgba(0,0,0,0.25)';ctx.fillRect(0,0,W,H);ctx.fillStyle='#fff';ctx.font='28px system-ui';ctx.fillText('Game Over',W/2-80,H/2-10);ctx.font='16px system-ui';ctx.fillText('Presiona R para reiniciar',W/2-110,H/2+20);ctx.fillStyle='#ffdca8';ctx.fillText('Puntos: '+Math.floor(score),W/2-100,H/2+60);}
  requestAnimationFrame(loop);
}

function reset(){obstacles=[];leaves=[];for(let i=0;i<12;i++)spawnLeaf();player.y=GROUND_Y-SPR_H+10;player.vy=0;player.jumping=false;player.ducking=false;player.frame=0;score=0;speed=6;gameOver=false;}

spriteImg.onload=()=>{requestAnimationFrame(loop);};
canvas.addEventListener('touchstart',e=>{e.preventDefault();if(gameOver)reset();else{keys['Space']=true;setTimeout(()=>keys['Space']=false,150);}});
</script>
</body>
</html>
